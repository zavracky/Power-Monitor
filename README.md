# Power-Monitor
The initial intent of this project is to protect the Raspberry Pi running Home Assistant (home automation) during a power outage.  When power is lost, an uninterruptable power supply (UPS) continues to provide power to the Raspberry.  Unfortunately, the UPS does not send information to the owner about the power loss.  As a result, there is a high likelihood that the Raspberry will continue to run until the UPS runs out of energy, and then it will suffer an abrupt shut down which endangers the operating system.  Other computers that draw power from the UPS, will suffer a similar fate.  This situation is avoidable if the owner is made aware and has the ability from his location to shut the systems down manually.  

Making the owner aware through Home Assistant (HA) is a relatively easy task if the power is monitored by a device that communicates with HA.  In this project, that device is an Arduino running a MySensors implementation.  A circuit which includes an Arduino, an NRF24 radio, a relay, and two USB ports has been frabricated.  One USB port connects to a 5 Volt power supply plugged into an outlet for power failure detection.  The second USB port provides power to the Raspberry.  Power for the circuit is provided by the UPS.  The circuit directs power to the Raspberry by closing the relay thus connecting the UPS power source.  

When power is lost, the Arduino detects that loss and sends a message to HA.  HA, through an automation, sends a message to the owner.  The owner can then use whatever means are available to access the home network and manually shut down any computers at risk.  However, if the owner is not able to respond, the Arduino will take action at the end of a predetermined delay.  That action will inform HA that the clock has run out.  HA, through a second automation, will shut down all the PCs on the network, after which it will send a message to the Arduino that it's task has been completed, and then shut itself down.  The Arduino will wait a bit and then disconnect the power from the Raspberry.  

Once power is restored, the Arduino will either detect the power return while still under UPS power, or it will boot up and check to see if power is available.  If so, it will turn on the relay providing power to the raspberry.  This reboots the Raspberry.
